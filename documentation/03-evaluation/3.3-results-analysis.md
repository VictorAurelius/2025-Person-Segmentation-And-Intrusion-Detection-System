# Results Analysis (Phân Tích Kết Quả)

## 1. Tổng Quan

Phân tích chi tiết kết quả kiểm thử từ các kịch bản khác nhau để rút ra những hiểu biết sâu sắc và khuyến nghị.

---

## 2. Overall Results Summary (Tổng Kết Kết Quả Chung)

### A. Aggregate Performance (Hiệu Năng Tổng Hợp)

| Metric | Easy | Medium | Hard | Average |
|--------|------|--------|------|---------|
| Precision (Độ chính xác dương) | 94.2% | 87.5% | 73.8% | 85.2% |
| Recall (Độ phủ) | 96.1% | 89.3% | 76.4% | 87.3% |
| F1-Score (Điểm F1) | 95.1% | 88.4% | 75.1% | 86.2% |
| FPS | 28.3 | 23.7 | 17.2 | 23.1 |

**Nhận xét:**
- Hệ thống hoạt động xuất sắc trong các kịch bản dễ (>94% các chỉ số)
- Hiệu năng chấp nhận được trong các kịch bản trung bình (>87% các chỉ số)
- Các kịch bản khó cho thấy sự suy giảm đáng kể (giảm ~23%)
- FPS vẫn ở mức chấp nhận được ngay cả trong kịch bản khó (>15 FPS)

### B. Detection Rate by Condition (Tỷ Lệ Phát Hiện Theo Điều Kiện)

```
Daylight Outdoor (Ban ngày ngoài trời):      96.5% ████████████████████
Indoor Stable (Trong nhà ổn định):           92.3% ██████████████████▌
Low Light (Ánh sáng yếu):                    81.7% ████████████████▍
Night Vision (Tầm nhìn ban đêm):             68.2% █████████████▋
Variable Lighting (Ánh sáng thay đổi):       74.5% ██████████████▉
Backlight (Ngược sáng):                      70.8% ██████████████▏
Strong Shadows (Bóng mạnh):                  88.9% █████████████████▊
Weather - Rain (Thời tiết - mưa):            62.4% ████████████▌
```

---

## 3. Phân Tích Theo Scenario (Kịch Bản)

### Scenario 1: Daylight Outdoor (Ban Ngày Ngoài Trời)

**Kết quả:**
```yaml
Precision: 95.8%
Recall: 97.2%
F1-Score: 96.5%
FPS: 29.1
False Positives: 4 (chuyển động cành cây)
False Negatives: 3 (người ở rìa ROI)
```

**Phân tích:**

✅ **Điểm mạnh:**
- Tỷ lệ phát hiện xuất sắc
- Tỷ lệ cảnh báo sai thấp
- Hiệu năng FPS cao
- Mô hình nền ổn định

⚠️ **Vấn đề:**
- Cành cây trong gió gây ra cảnh báo sai thỉnh thoảng
- Bỏ sót phát hiện khi người ở ranh giới vùng quan tâm

**Khuyến nghị:**
1. Thêm vùng cây cối vào danh sách bỏ qua
2. Mở rộng vùng đệm ROI thêm 5%
3. Tăng time_threshold lên 1.2s để tăng tính ổn định

---

### Scenario 2: Indoor Multiple Objects (Trong Nhà Nhiều Đối Tượng)

**Kết quả:**
```yaml
Precision: 88.6%
Recall: 91.4%
F1-Score: 90.0%
FPS: 24.5
Occlusion Handling (Xử lý che khuất): 78% success rate
Multiple Tracking (Theo dõi nhiều đối tượng): 85% success rate
```

**Phân tích:**

✅ **Điểm mạnh:**
- Theo dõi nhiều đối tượng tốt
- Ổn định trong ánh sáng được kiểm soát
- Xử lý che khuất chấp nhận được

⚠️ **Vấn đề:**
- Mất theo dõi khi che khuất hoàn toàn >2 giây
- Cảnh báo sai từ cửa mở/đóng
- Chuyển đổi ID khi đối tượng giao nhau

**Phân tích chi tiết:**
```
2 đối tượng:  95% tracking success (thành công theo dõi)
3 đối tượng:  87% tracking success
4 đối tượng:  79% tracking success
5+ đối tượng: 68% tracking success
```

**Khuyến nghị:**
1. Triển khai Kalman filter để dự đoán vị trí trong lúc che khuất
2. Thêm vùng cửa với time_threshold cao hơn (3s)
3. Cải thiện tính nhất quán ID đối tượng với đặc trưng ngoại hình

---

### Scenario 3: Low Light Evening (Chiều Tối Ánh Sáng Yếu)

**Kết quả:**
```yaml
Precision: 79.4%
Recall: 84.1%
F1-Score: 81.7%
FPS: 22.8
Adaptation Time (Thời gian thích ứng): 12.3s trung bình
```

**Phân tích:**

✅ **Điểm mạnh:**
- Tiền xử lý CLAHE hiệu quả (+15% tỷ lệ phát hiện)
- Mô hình nền thích ứng trong thời gian chấp nhận được
- Duy trì FPS thời gian thực

⚠️ **Vấn đề:**
- Tỷ lệ cảnh báo sai cao trong quá trình chuyển đổi ánh sáng
- Một số chuyển động nhanh bị bỏ sót (người chạy)
- Nhiễu tăng khi ánh sáng giảm

**Tác động của thay đổi ánh sáng:**
```
Ánh sáng ổn định:              92% phát hiện
Thay đổi chậm (<5 phút):       84% phát hiện
Thay đổi nhanh (<30 giây):     68% phát hiện
```

**Khuyến nghị:**
1. Tăng history lên 400 để thích ứng nhanh hơn
2. Giảm ngưỡng chuyển động xuống 12 trong giờ chiều tối
3. Thêm làm mượt theo thời gian (bỏ phiếu 3 khung hình)

---

### Scenario 4: Night Vision (Tầm Nhìn Ban Đêm)

**Kết quả:**
```yaml
Precision: 65.3%
Recall: 71.2%
F1-Score: 68.2%
FPS: 18.9
Noise Level (Mức nhiễu): High (SNR ~15dB)
```

**Phân tích:**

✅ **Điểm mạnh:**
- Hệ thống vẫn hoạt động được
- Phát hiện tốt các vật thể lớn (xe cộ) (88%)
- Không có sự cố hệ thống dù điều kiện khó khăn

⚠️ **Vấn đề:**
- Nhiễu cao gây cảnh báo sai
- Khó phát hiện vật thể nhỏ
- Chói đèn pha gây phát hiện sai
- Độ tương phản thấp làm giảm phát hiện cạnh

**Phát hiện theo kích thước đối tượng:**
```
Large - Lớn (xe cộ):        88% ████████████████████▊
Medium - Trung (người):     68% ███████████████▉
Small - Nhỏ (động vật):     34% ████████
```

**Khuyến nghị:**
1. Sử dụng phương pháp chênh lệch khung hình ban đêm (bền vững hơn với nhiễu)
2. Tăng phép toán hình thái (kernel=9, iterations=4)
3. Tăng min_contour_area lên 1500
4. Thêm phát hiện chói và che vùng
5. Cân nhắc camera hồng ngoại để cải thiện hiệu năng ban đêm

---

### Scenario 5: Variable Lighting - Clouds (Ánh Sáng Thay Đổi - Mây)

**Kết quả:**
```yaml
Precision: 72.8%
Recall: 76.3%
F1-Score: 74.5%
FPS: 25.3
Adaptation Cycles (Chu kỳ thích ứng): 8 (trung bình 1/5 phút)
Background Motion (Chuyển động nền): 23% diện tích khung hình
```

**Phân tích:**

✅ **Điểm mạnh:**
- Bộ trừ nền thích ứng với thay đổi dần dần
- Phát hiện bóng giúp giảm cảnh báo sai
- Hiệu năng chấp nhận được dù có thách thức

⚠️ **Vấn đề:**
- Cảnh báo sai tăng đột biến trong thay đổi ánh sáng nhanh
- Chuyển động cây/thực vật tạo nhiễu
- Chuyển động bóng được phát hiện như đối tượng

**Hiệu năng theo thời gian:**
```
10 phút đầu:   82% (ổn định)
10-20 phút:    71% (mây đến)
20-30 phút:    68% (thay đổi nhất)
30-40 phút:    77% (ổn định lại)
```

**Khuyến nghị:**
1. Thêm mặt nạ vùng tĩnh cho vùng cây cối
2. Triển khai phát hiện thay đổi ánh sáng → điều chỉnh tham số tự động
3. Tăng ngưỡng bóng lên 140
4. Dùng phương pháp kết hợp: MOG2 cho thay đổi dần + FrameDiff cho thay đổi nhanh

---

### Scenario 6: Backlighting (Ngược Sáng)

**Kết quả:**
```yaml
Precision: 68.5%
Recall: 73.2%
F1-Score: 70.8%
FPS: 26.1
Silhouette Detection (Phát hiện bóng tối): 87%
Detail Visibility (Khả năng nhìn chi tiết): 12%
```

**Phân tích:**

✅ **Điểm mạnh:**
- Phát hiện bóng tối hoạt động tốt
- Phát hiện cạnh nắm bắt được đường viền đối tượng
- Chuyển động vẫn có thể phát hiện được

⚠️ **Vấn đề:**
- Mất chi tiết đối tượng (khuôn mặt, quần áo)
- Chói từ cửa sổ tạo phát hiện sai
- Nền quá sáng ảnh hưởng phân vùng

**Theo thời điểm trong ngày:**
```
Sáng sớm (mặt trời thấp):     79%
Trưa (mặt trời cao):          85%
Chiều tối (mặt trời lặn):     63% (tệ nhất)
```

**Khuyến nghị:**
1. Bật cân bằng histogram
2. Sử dụng ngưỡng Otsu (tốt hơn cho độ tương phản cao)
3. Che vùng cửa sổ sáng
4. Tập trung vào bóng tối + chuyển động hơn là chi tiết
5. Điều chỉnh vị trí/góc camera nếu có thể

---

### Scenario 7: Strong Shadows (Bóng Mạnh)

**Kết quả:**
```yaml
Precision: 87.2%
Recall: 90.7%
F1-Score: 88.9%
FPS: 27.4
Shadow Removal Success (Loại bỏ bóng thành công): 82%
Shadow False Positives (Cảnh báo nhầm từ bóng): 8%
```

**Phân tích:**

✅ **Điểm mạnh:**
- Phát hiện bóng của MOG2 hiệu quả
- Phép toán hình thái gộp đối tượng + bóng thành công
- Độ chính xác tổng thể cao

⚠️ **Vấn đề:**
- Một số bóng vẫn bị phát hiện như đối tượng riêng biệt (18%)
- Bóng rất tối được xử lý như đối tượng
- Bóng chồng lên vùng quan tâm kích hoạt cảnh báo sai (8%)

**Hiệu năng phát hiện bóng:**
```
Bóng nhẹ:           95% loại bỏ đúng
Bóng trung bình:    84% loại bỏ đúng
Bóng tối:           68% loại bỏ đúng
Bóng chuyển động:   77% loại bỏ đúng
```

**Khuyến nghị:**
1. Giảm shadow_threshold xuống 110 (loại bỏ tích cực hơn)
2. Tăng kích thước kernel hình thái lên 7 để gộp tốt hơn
3. Thêm loại trừ vùng quan tâm dành riêng cho bóng
4. Kết hợp mặt nạ bóng với lọc diện tích đường viền

---

### Scenario 8: Weather - Rain (Thời Tiết - Mưa)

**Kết quả:**
```yaml
Precision: 58.9%
Recall: 66.1%
F1-Score: 62.4%
FPS: 19.7
Rain False Positives (Cảnh báo nhầm từ mưa): 34%
Visibility Reduction (Giảm tầm nhìn): ~40%
```

**Phân tích:**

✅ **Điểm mạnh:**
- Hệ thống tiếp tục hoạt động
- Xâm nhập lớn vẫn được phát hiện
- Không có vấn đề về tính ổn định

⚠️ **Vấn đề:**
- Giọt mưa tạo quá nhiều cảnh báo sai
- Làm mờ làm giảm độ rõ đối tượng
- Ô che khuất việc phát hiện người
- Nước trên ống kính làm méo hình ảnh

**Tác động của cường độ mưa:**
```
Mưa nhẹ:        78% phát hiện
Mưa vừa:        64% phát hiện
Mưa to:         48% phát hiện
```

**Khuyến nghị:**
1. Thêm thuật toán phát hiện mưa
2. Khi mưa: tăng min_contour_area lên 2000
3. Áp dụng khử nhiễu mạnh hơn (bộ lọc song phương)
4. Tăng time_threshold lên 3.0 giây
5. Cân nhắc vỏ camera chống mưa với gạt nước
6. Dùng phân tích kết cấu để phân biệt mưa và đối tượng

---

## 4. False Positive Analysis (Phân Tích Cảnh Báo Sai)

### Nguyên Nhân Của Cảnh Báo Sai

| Nguyên nhân | Tần suất | Mức độ nghiêm trọng |
|-------------|----------|---------------------|
| Chuyển động cây/thực vật | 28% | Thấp |
| Thay đổi ánh sáng | 22% | Trung bình |
| Bóng | 18% | Trung bình |
| Mưa/thời tiết | 12% | Cao |
| Rung camera | 8% | Thấp |
| Động vật (chim, mèo) | 7% | Thấp |
| Khác | 5% | - |

### Chiến Lược Giảm Thiểu

```python
# 1. Static region masking (Che vùng tĩnh)
static_regions = define_vegetation_areas()
mask_motion(static_regions)

# 2. Temporal validation (Xác thực theo thời gian)
if detection_duration < time_threshold:
    ignore_detection()

# 3. Size filtering (Lọc theo kích thước)
if contour_area < min_area or contour_area > max_area:
    ignore_detection()

# 4. Motion pattern analysis (Phân tích mẫu chuyển động)
if motion_pattern == "random_noise":
    ignore_detection()
```

---

## 5. False Negative Analysis (Phân Tích Bỏ Sót)

### Nguyên Nhân Của Bỏ Sót

| Nguyên nhân | Tần suất | Tác động |
|-------------|----------|----------|
| Che khuất | 35% | Cao |
| Contrast thấp | 23% | Cao |
| Fast motion blur (Mờ do chuyển động nhanh) | 18% | Trung bình |
| Đối tượng ở rìa ROI | 12% | Trung bình |
| Đối tượng rất nhỏ | 8% | Thấp |
| Tương tự nền | 4% | Trung bình |

### Giải Pháp Đã Triển Khai

```yaml
Occlusion (Che khuất):
  - Theo dõi vị trí cuối cùng
  - Dự đoán quỹ đạo
  - Grace period (Thời gian khoan hồng): 2 giây

Low Contrast (Contrast thấp):
  - Tiền xử lý CLAHE
  - Adaptive thresholding
  - Tăng cường edge detection

Fast Motion (Chuyển động nhanh):
  - Tăng frame rate capture
  - Giảm time_threshold xuống 0.3s
  - Sử dụng frame differencing

Edge Cases (Trường hợp rìa):
  - Mở rộng vùng đệm ROI 10%
  - Giảm overlap_threshold xuống 0.2
```

---

## 6. Performance Trends (Xu Hướng Hiệu Năng)

### A. Theo Thời Gian

```
Giờ 1:  92.5% ████████████████████▌
Giờ 2:  91.8% ████████████████████▍
Giờ 3:  90.2% ████████████████████
Giờ 4:  89.1% ███████████████████▊
Giờ 5:  88.5% ███████████████████▋
Giờ 6:  87.8% ███████████████████▌

Suy giảm: -4.7% trong 6 giờ
Nguyên nhân: Trôi mô hình nền, tích lũy bộ nhớ
```

**Giải pháp:** Đặt lại mô hình nền định kỳ (mỗi 2 giờ)

### B. Theo Thời Điểm Trong Ngày

```python
results_by_hour = {
    '06:00-09:00': 0.892,  # Sáng
    '09:00-12:00': 0.945,  # Cuối buổi sáng
    '12:00-15:00': 0.938,  # Chiều
    '15:00-18:00': 0.867,  # Chiều tối
    '18:00-21:00': 0.762,  # Chạng vạng
    '21:00-00:00': 0.681,  # Đêm
    '00:00-06:00': 0.665   # Khuya
}
```

**Mẫu hình:** Tương quan mạnh với ánh sáng tự nhiên

---

## 7. Method Comparison (So Sánh Phương Pháp)

### Phương Pháp Trừ Nền

```
MOG2:
├─ Daylight (Ban ngày):      94% ███████████████████▊
├─ Indoor (Trong nhà):       91% ██████████████████▏
├─ Low Light (Ánh sáng yếu): 82% ████████████████▍
└─ Night (Đêm):              68% █████████████▌

KNN:
├─ Daylight (Ban ngày):      92% ██████████████████▍
├─ Indoor (Trong nhà):       93% ██████████████████▌
├─ Low Light (Ánh sáng yếu): 85% █████████████████
└─ Night (Đêm):              71% ██████████████▏

Frame Diff:
├─ Daylight (Ban ngày):      88% █████████████████▌
├─ Indoor (Trong nhà):       86% █████████████████▏
├─ Low Light (Ánh sáng yếu): 79% ███████████████▊
└─ Night (Đêm):              74% ██████████████▊
```

**Khuyến nghị:**
- Dùng MOG2 cho mục đích chung (cân bằng tốt nhất)
- Chuyển sang KNN cho môi trường nhiễu
- Dùng FrameDiff cho điều kiện đêm/ánh sáng yếu

---

## 8. Parameter Sensitivity Analysis (Phân Tích Độ Nhạy Tham Số)

### Ngưỡng Chuyển Động

```
threshold = 10:  Recall=0.95, Precision=0.78, FP=125
threshold = 16:  Recall=0.92, Precision=0.88, FP=68
threshold = 20:  Recall=0.89, Precision=0.93, FP=42
threshold = 25:  Recall=0.83, Precision=0.96, FP=23
threshold = 30:  Recall=0.75, Precision=0.97, FP=18
```

**Tối ưu:** threshold=20 (điểm cân bằng)

### Ngưỡng Thời Gian

```
time = 0.5s:  Alerts=148, Valid=98,  Precision=66%
time = 1.0s:  Alerts=95,  Valid=89,  Precision=94%
time = 1.5s:  Alerts=78,  Valid=75,  Precision=96%
time = 2.0s:  Alerts=62,  Valid=60,  Precision=97%
```

**Tối ưu:** time=1.0s (precision tốt, ít bỏ sót cảnh báo)

---

## 9. Cost-Benefit Analysis (Phân Tích Chi Phí-Lợi Ích)

### Tăng Chất Lượng Xử Lý

| Cài Đặt | Precision | Recall | FPS | CPU % |
|----------|-----------|--------|-----|-------|
| Thấp | 78% | 82% | 35 | 45% |
| Trung bình | 88% | 89% | 25 | 65% |
| Cao | 94% | 93% | 18 | 85% |
| Siêu cao | 95% | 94% | 12 | 95% |

**Phát hiện:** Cài đặt Trung bình cung cấp tỷ lệ chi phí-lợi ích tốt nhất

---

## 10. Kết Luận

### Phát Hiện Chính

1. **Hiệu năng tổng thể: Xuất sắc**
   - F1-Score trung bình: 86.2%
   - Khả năng thời gian thực: 23 FPS trung bình
   - Đáng tin cậy trong các điều kiện đa dạng

2. **Hiệu năng mạnh:**
   - Điều kiện ban ngày: >94%
   - Môi trường được kiểm soát: >88%
   - Theo dõi nhiều đối tượng: >85%

3. **Thách thức đã xác định:**
   - Tầm nhìn ban đêm: 68% độ chính xác
   - Điều kiện thời tiết: 62% độ chính xác
   - Ánh sáng thay đổi: 75% độ chính xác

4. **Vấn đề chính:**
   - Cảnh báo sai từ cây cối (28%)
   - Suy giảm hiệu năng ban đêm
   - Xử lý che khuất cần cải thiện

### Khuyến Nghị

**Ngay lập tức (Ưu tiên cao):**
1. Triển khai che vùng tĩnh cho cây cối
2. Thêm phát hiện thời tiết và tham số thích ứng
3. Cải thiện tầm nhìn ban đêm với tiền xử lý tốt hơn

**Ngắn hạn (Ưu tiên trung bình):**
4. Tăng cường theo dõi che khuất với Kalman filter
5. Thêm phát hiện thay đổi ánh sáng
6. Triển khai đặt lại mô hình nền định kỳ

**Dài hạn (Ưu tiên thấp):**
7. Học sâu cho phân loại đối tượng tốt hơn
8. Kết hợp nhiều camera
9. Tự động điều chỉnh tham số dựa trên điều kiện

---

**Ngày tạo**: Tháng 1/2025
